<script>
    var xhr;
    var typingTimer;
    var typingInterval = 500;
    var searchInput = $('#media-list-search-{{ id }}');

    searchInput.on('keyup', function () {
        clearTimeout(typingTimer);
        var id = '{{ id }}';
        typingTimer = setTimeout(doSearch(this, id), typingInterval);
    });

    searchInput.on('keydown', function () {
        clearTimeout(typingTimer);
    });

    var doSearch = function (el, id) {
        var val = $(el).val();
        getMediaList(id, 1, val);

    };

    var getMediaList = function (id, page, search) {
        page = page || 1;
        var body = $('.m-body-' + id);
        xhr = $.ajax({
            url: '{{ path('admin_ajax_media_list') }}',
            type: 'POST',
            data: {
                page: page,
                search: search,
                idUnique: id
            },
            beforeSend: function () {
                if (xhr && xhr.readyState != 4) {
                    xhr.abort();
                }
                body.html('<img src="/bundles/spinner-transparent.gif" class="center-block modal-spinner"/>');
            },
            success: function (data) {
                body.html(data);
            }
        })
    };
</script>