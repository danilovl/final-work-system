{% stylesheets filter='cssrewrite,scssphp'
    'vendor/switchery/dist/switchery.min.css' %}
    <link rel="stylesheet" href="/compiled{{ asset_url }}"/>
{% endstylesheets %}

<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">
        <span aria-hidden="true">Ã—</span>
    </button>
    <h4 class="modal-title"> {{ conversation }} </h4>
</div>
<div class="ibox-content">
    <div class="row">
        <div class="chat-discussion">

            {% if conversationMessages is not empty %}
                {% for message in conversationMessages %}

                    {% if conversation_status.isConversationMessageRead(message, app.user, false) == false %}
                        {% set conversationMessageUnreadClass = 'conversation-message-unread' %}
                    {% else %}
                        {% set conversationMessageUnreadClass = null %}
                    {% endif %}

                    <div class="{% if message.owner.id == app.user.id %} chat-message-left {% else %} chat-message-right {% endif %}">
                        <img class="message-avatar"
                             src="{{ asset(message.owner.getProfileImagePath) }}"
                             alt="{{ message.owner }}">
                        <div class="{{ conversationMessageUnreadClass }} message">
                            <a class="message-author" href="#">
                                {{ message.owner }}
                            </a>
                            <span class="message-date">
                                {{ message.createdAt | date('Y-m-d H:i:s') }}

                                {% if message.isOwner(app.user) == false %}
                                    {% if conversationMessageUnreadClass is not empty %}
                                        <input class="js-switch small"
                                               data-switchery="true"
                                               data-target-type="complete"
                                               data-target-url="{{ path('conversation_message_change_read_status_ajax', { 'id': message.id | hashids_encode }) }}"
                                               title=""
                                               type="checkbox">
                                        {% else %}
                                        <input class="js-switch small"
                                               checked
                                               data-switchery="true"
                                               data-target-type="complete"
                                               data-target-url="{{ path('conversation_message_change_read_status_ajax', { 'id': message.id | hashids_encode }) }}"
                                               title=""
                                               type="checkbox">
                                    {% endif %}
                                {% endif %}

                            </span>
                            <span class="message-content">
                                {{ message.content | raw }}
                            </span>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                {{ 'finalwork.text.no_result' | trans() }}
            {% endif %}

        </div>
    </div>
</div>

{% javascripts filter='jsqueeze'
    'vendor/switchery/dist/switchery.min.js' %}
    <script src="/compiled{{ asset_url }}"></script>
{% endjavascripts %}

<script>
    $(document).ready(function () {
        initAjaxChangeStatus();
    });
</script>
