{% extends 'FinalWorkBundle::layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets filter='cssrewrite,scssphp'
        'vendor/switchery/dist/switchery.min.css' %}
        <link rel="stylesheet" href="/compiled{{ asset_url }}"/>
    {% endstylesheets %}
{% endblock %}

{% block content %}
    <div class="right_col" role="main">
        <div class="">
            <div class="clearfix"></div>
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_title">
                            <h2>
                                {{ conversation }}
                            </h2>
                            <ul class="nav navbar-rul c panel_toolbox">
                                <li>
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                </li>
                            </ul>
                            <div class="clearfix"></div>
                        </div>
                        <div class="x_content">
                            <div class="ibox-content">
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <div class="chat-discussion">

                                            {% if conversationMessages is not empty %}
                                                {% for message in conversationMessages %}

                                                    {% if conversation_status.isConversationMessageRead(message, app.user, false) == false %}
                                                        {% set conversationMessageUnreadClass = 'conversation-message-unread' %}
                                                    {% else %}
                                                        {% set conversationMessageUnreadClass = null %}
                                                    {% endif %}

                                                    <div class="{% if message.owner.id == app.user.id %} chat-message-left {% else %} chat-message-right {% endif %}">
                                                        <img class="message-avatar"
                                                             src="{{ asset(message.owner.getProfileImagePath) }}"
                                                             alt="{{ message.owner }}">
                                                        <div class="{{ conversationMessageUnreadClass }} message">
                                                            <a class="message-author" href="#">
                                                                {{ message.owner }}
                                                            </a>
                                                            <span class="message-date">
                                                                {{ message.createdAt | date('Y-m-d H:i:s') }}

                                                                {% if message.isOwner(app.user) == false %}
                                                                    {% if conversationMessageUnreadClass is not empty %}
                                                                        <input class="js-switch small"
                                                                               data-switchery="true"
                                                                               data-target-type="complete"
                                                                               data-target-url="{{ path('conversation_message_change_read_status_ajax', { 'id': message.id | hashids_encode }) }}"
                                                                               title=""
                                                                               type="checkbox">
                                                                    {% else %}
                                                                        <input class="js-switch small"
                                                                               checked
                                                                               data-switchery="true"
                                                                               data-target-type="complete"
                                                                               data-target-url="{{ path('conversation_message_change_read_status_ajax', { 'id': message.id | hashids_encode }) }}"
                                                                               title=""
                                                                               type="checkbox">
                                                                    {% endif %}
                                                                {% endif %}

                                                            </span>
                                                            <span class="message-content">
                                                                {{ message.content | raw }}
                                                            </span>
                                                        </div>
                                                    </div>
                                                {% endfor %}
                                            {% else %}
                                                {{ 'finalwork.text.no_result' | trans() }}
                                            {% endif %}

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% javascripts filter='jsqueeze'
        'vendor/switchery/dist/switchery.min.js' %}
        <script src="/compiled{{ asset_url }}"></script>
    {% endjavascripts %}
{% endblock %}

{% block javascript %}
    {{ parent() }}
    <script>
        $(document).ready(function () {
            initAjaxChangeStatus();
        });
    </script>
{% endblock %}